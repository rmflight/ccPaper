# Crohn's VS Ulcerative Colitis

GEO dataset **GSE36807** has crohn's, uc, and normal samples. 

```{r getData, eval=FALSE}
library(GEOquery)

cucData <- getGEO(GEO="GSE36807")[[1]]

tmpP <- pData(cucData)
tmpP$status <- "control"

cLoc <- grep("Crohn", tmpP$characteristics_ch1)
tmpP$status[cLoc] <- "crohns"

ucLoc <- grep("Ulcerative colitis", tmpP$characteristics_ch1)
tmpP$status[ucLoc] <- "uc"
pData(cucData) <- tmpP

.sessionInfo <- sessionInfo()
.timeDate <- Sys.time()
save(cucData, .sessionInfo, .timeDate, file="inst/data/uc_crohns_rawData.RData")
```

## Differential analysis

Use the `limma` package to rank probes. 

```{r rankProbes}
library(limma)
library(hgu133plus2.db)
load("inst/data/uc_crohns_rawData.RData")

cucComps <- c("uc - control", "crohns - control")
geneID <- unlist(mget(featureNames(cucData), hgu133plus2ENTREZID))

cucExpr <- exprs(cucData)
cucCollapse <- collapseProbes(cucExpr, geneID) # collapse to single genes using median of expression
cucCharacter <- pData(cucData)

cucFC <- rankGenes(cucCollapse, cucCharacter$status, cucComps, doAggregation=FALSE, aggregateIndex=NA)
names(cucFC) <- c("UC", "CROHNS")

cucDiff <- lapply(cucFC, getDiffGenes, id="id")
# this object can be run using base ccEnrich, or can be easily coerced
```


## Run GSEA type analysis using limma

There are two ways to do GSEA using `limma`. 

  1 Use `romer` for competitive tests with rotations to do random samples
  2 Use `geneSetTest` for gene-wise competitive tests, *i.e.* each set is tested against random gene samples
  
We're going to try both and see what we get out.

```{r setupGeneSets}
library(GO.db)
hsGO <- as.list(org.Hs.egGO2ALLEGS)
hsGO <- hsGO[(Ontology(names(hsGO)) == "BP")]
hsGO <- lapply(hsGO, unique)

useSet <- symbols2indices(hsGO, rownames(cucCollapse))
```

Run using `romer`

```{r runRomer}
exprData <- cucCollapse
sampleStatus <- cucCharacter$status
doComps <- cucComps
f <- factor(sampleStatus)
design <- model.matrix(~0 + f)
colnames(design) <- levels(f)

contrast.matrix <- makeContrasts(contrasts=doComps, levels=design)

cucRomer <- multicontrastRomer(useSet, cucCollapse, design, contrast.matrix, nrot=10000)
save(cucRomer, file="inst/data/cucRomer.RData")

```

Run using `geneSetTest`

```{r runGeneSetTest}
statData <- cucFC$UC
useStat <- "t"
```

